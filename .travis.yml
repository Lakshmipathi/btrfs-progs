#
# Copyright (C) 2016 Roman Lebedev.
# Copyright (C) 2017 Lakshmipathi.G
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public
# License v2 as published by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public
# License along with this program; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place - Suite 330,
# Boston, MA 021110-1307, USA.
#

sudo: required

language: c
compiler:
  - gcc
  - clang

cache:
  ccache: true

git:
  depth: 2

dist: trusty
group: unstable

branches:
  only:
  - devel
  - coverity_scan
  - master
  - release-test
  - test-travis-docker

services:
  - docker

env:
  global:
   - SRC_DIR=/btrfs-progs

before_install:
  - docker pull laks/btrfs_armv6
 # - docker pull laks/btrfs_armv8
  - sudo apt-get install -qq e2fslibs-dev gcc libacl1-dev libblkid-dev liblzo2-dev make pkg-config udev zlib1g-dev acl attr reiserfsprogs

script:
  # Prepare QEMU
  - sudo docker run -it --privileged=true multiarch/qemu-user-static:register --reset

  # Launch container
  - travis/docker-arch-run arm6 "make TEST_LOG=dump test-cli"
  #- travis/docker-arch-run arm8 "make TEST_LOG=dump test-cli"
  - ./autogen.sh && ./configure --disable-documentation && make

#  - sudo docker run --volume $TRAVIS_BUILD_DIR:$SRC_DIR --workdir $SRC_DIR --privileged=true --device=/dev/loop0:/dev/loop0 --device=/dev/loop1:/dev/loop1 --device=/dev/loop2:/dev/loop2 --device=/dev/loop3:/dev/loop3 --device=/dev/loop4:/dev/loop4 laks/btrfs_armv6  sh -c "./autogen.sh && ./configure --disable-documentation && make && make install && btrfs --version"
 # - sudo docker run --volume $TRAVIS_BUILD_DIR:$SRC_DIR --workdir $SRC_DIR --privileged=true --device=/dev/loop0:/dev/loop0 --device=/dev/loop1:/dev/loop1 --device=/dev/loop2:/dev/loop2 --device=/dev/loop3:/dev/loop3 --device=/dev/loop4:/dev/loop4 laks/btrfs_armv8  sh -c "./autogen.sh && ./configure --disable-documentation && make && make install && btrfs --version"
